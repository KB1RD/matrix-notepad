(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{1299:function(e,t,n){var content=n(1301);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(73).default)("6759f5ab",content,!0,{sourceMap:!1})},1300:function(e,t,n){"use strict";var r=n(1299);n.n(r).a},1301:function(e,t,n){(e.exports=n(72)(!1)).push([e.i,".vue-codemirror .CodeMirror{height:100%}.container{margin:0 auto;min-height:100vh;display:-webkit-box;display:flex;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center;text-align:center}.container>*{width:100%;max-width:1000px}.signin-overlay{display:none}.has-signin-overlay .signin-overlay{display:block;width:100%;height:100%;position:absolute;top:0;left:0;display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center;background-color:hsla(0,0%,100%,.86667);z-index:1000}",""])},1302:function(e,t,n){"use strict";n.r(t);n(325),n(104),n(156),n(216),n(88),n(68),n(217);var r=n(210),o=n(320),c={props:{working:Boolean,signedIn:Boolean},data:function(){return{settings:this.$form.createForm(this)}},methods:{submit:function(e){e.preventDefault();var t=this;this.settings.validateFields((function(e,n){e||t.$emit("submit",n)}))}}},l=n(130),m=Object(l.a)(c,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-form",{attrs:{form:e.settings,layout:"vertical","hide-required-mark":""},on:{submit:e.submit}},[n("a-row",{attrs:{gutter:16}},[n("a-col",[e._v("\n      Note that this software is "),n("b",[e._v("highly")]),e._v(" experimental. Do "),n("b",[e._v("not")]),e._v(" use\n      this to store confidential or important information. Also, this adds a\n      ton of events to whichever room is chosen, so... be careful. Also, most\n      upgrades will introduce breaking changes at the moment with no real\n      upgrade path. Sorry.\n    ")])],1),e._v(" "),n("a-row",{attrs:{gutter:16}},[n("a-col",[n("a-form-item",{attrs:{label:"Homeserver Name"}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["hs",{initialValue:e.$store.state.matrix.credentials.hs}],expression:"[\n            'hs',\n            { initialValue: $store.state.matrix.credentials.hs }\n          ]"}],attrs:{placeholder:"https://matrix.org"}})],1)],1)],1),e._v(" "),n("a-row",{attrs:{gutter:16}},[n("a-col",[n("a-form-item",{attrs:{label:"Access Token"}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["token",{initialValue:e.$store.state.matrix.credentials.access_token,rules:[{required:!0,message:"An access token is required"}]}],expression:"[\n            'token',\n            {\n              initialValue: $store.state.matrix.credentials.access_token,\n              rules: [\n                {\n                  required: true,\n                  message: 'An access token is required'\n                }\n              ]\n            }\n          ]"}],attrs:{placeholder:"ABCDEF1234"}})],1)],1)],1),e._v(" "),n("a-row",{attrs:{gutter:16}},[n("a-col",[n("a-form-item",{attrs:{label:"Room"}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["room",{initialValue:e.$store.state.matrix.working_room,rules:[{required:!0,message:"A room to join is required"},{pattern:/^[!#][^\!\:]*:[^\!\:]*(:[0-9]+)?$/gm,message:"This is not a valid Matrix room ID or alias"}]}],expression:"[\n            'room',\n            {\n              initialValue: $store.state.matrix.working_room,\n              rules: [\n                {\n                  required: true,\n                  message: 'A room to join is required'\n                },\n                {\n                  pattern: /^[!#][^\\!\\:]*:[^\\!\\:]*(:[0-9]+)?$/gm,\n                  message: 'This is not a valid Matrix room ID or alias'\n                }\n              ]\n            }\n          ]"}],attrs:{placeholder:"!roomid:matrix.org"}})],1)],1)],1),e._v(" "),n("a-row",{attrs:{gutter:16}},[n("a-col",[n("a-form-item",[n("a-checkbox",{directives:[{name:"decorator",rawName:"v-decorator",value:["debug",{initialValue:e.$store.state.debug}],expression:"['debug', { initialValue: $store.state.debug }]"}]},[e._v("\n          Enable verbose debug\n        ")])],1)],1)],1),e._v(" "),n("a-row",{attrs:{gutter:16}},[n("a-col",[n("a-button",{attrs:{type:"primary",loading:e.working,"html-type":"submit"}},[e._v("\n        "+e._s(e.working?"Working...":e.signedIn?"Update":"Sign In")+"\n      ")])],1)],1)],1)}),[],!1,null,null,null).exports,d=n(50);function h(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}var v={components:{TemporarySignin:m},data:function(){return{setup_visible:!1,text:"",cmOption:{tabSize:4,foldGutter:!0,styleActiveLine:!0,lineNumbers:!0,line:!0,theme:"mdn-like"},changes_to_ignore:{}}},computed:{signed_in:function(){return this.$store.state.matrix.matrix_state&&"STOPPED"!==this.$store.state.matrix.matrix_state},is_busy:function(){return this.$store.getters.hasBlockingOperation},is_reconnecting:function(){return"RECONNECTING"===this.$store.state.matrix.matrix_state}},created:function(){if(this.$store.state.matrix.credentials.hs&&this.$store.state.matrix.credentials.access_token&&this.$store.state.matrix.working_room){var e=this.$store.state.matrix;this.signIn(e.credentials.hs,e.credentials.access_token,e.working_room)}},methods:function(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?h(source,!0).forEach((function(t){Object(r.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):h(source).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}({openMatrixSetup:function(){this.setup_visible=!0},closeMatrixSetup:function(){this.setup_visible=!1,this.signed_in||this.$message.warning("Operation cancelled. You are not signed in")},signIn:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.$matrix.shutdown(),this.text="",this.changes_to_ignore={};var o=this.$message.loading("Signing in...",0),c=this;c.$store.dispatch("watchBlockingOperation",c.$matrix.attemptSignIn(e,t,n,(function(e){e.fatal?(console.error("Fatal internal error",e),c.$message.error("Fatal internal error")):(console.warn("Internal error",e),c.$message.warning("Internal errors encountered. See console for details"))}),this.onRemoteInsert,this.onRemoteRemove).then((function(){r&&c.updateSettings({hs:e,token:t,room:n}),o(),c.$message.success("You're signed in!"),c.setup_visible=!1}),(function(e){o(),console.error("Failed to sign in",e),c.$message.error("Failed to sign in!")})))},onSettingsFormSubmit:function(e){var t={hs:"https://matrix.org"};Object.keys(e).forEach((function(n){!e[n]&&0!==e[n]||""===e[n]||(t[n]=e[n])})),this.setDebugEnabled(e.debug),this.signIn(t.hs,t.token,t.room,!0)},onRemoteInsert:function(e,text,meta){var t=this.$refs.codemirror.codemirror.doc;d.a.log("INSERT '".concat(text,"' AT ").concat(e));var n=t.posFromIndex(e);this.changes_to_ignore[n.line]||(this.changes_to_ignore[n.line]=[]),this.changes_to_ignore[n.line].push(n.ch),t.replaceRange(text,n,n)},onRemoteRemove:function(e,t){var n=this.$refs.codemirror.codemirror.doc;d.a.log("REMOVE ".concat(t," CHARS AT ").concat(e));var r=n.posFromIndex(e),o=n.posFromIndex(e+t);this.changes_to_ignore[r.line]||(this.changes_to_ignore[r.line]=[]),this.changes_to_ignore[r.line].push(r.ch),n.replaceRange("",r,o)},onNewChanges:function(e,t){var n=this;if(this.$matrix.doc){var r=this.$matrix;t.forEach((function(t){if(n.changes_to_ignore[t.from.line]&&n.changes_to_ignore[t.from.line].includes(t.from.ch))return n.changes_to_ignore[t.from.line].pop(t.from.ch),void(n.changes_to_ignore[t.from.line].length||delete n.changes_to_ignore[t.from.line]);var o,text,c=Object.assign({},t.from),l=e.indexFromPos(c),m=Object.assign({},t.from);o=m,text=t.text,o.line+=text.length-1,text.length>1&&(o.ch=0),o.ch+=text[text.length-1].length;var d=t.removed.length-1;t.removed.forEach((function(e){d+=e.length}));var h=t.text.join("\n");d&&r.doc.remove(l,d),h.length&&r.doc.insert(l,h)}))}}},Object(o.b)({updateSettings:"matrix/updateSettings",setDebugEnabled:"setDebugEnabled"}))},f=(n(1300),Object(l.a)(v,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container"},[n("div",[n("a-drawer",{attrs:{visible:e.setup_visible,title:"Matrix Setup",placement:"right",closable:!0},on:{close:e.closeMatrixSetup}},[n("TemporarySignin",{attrs:{working:e.is_busy,"signed-in":e.signed_in},on:{submit:e.onSettingsFormSubmit}})],1),e._v(" "),n("a-spin",{attrs:{spinning:e.is_busy||e.is_reconnecting}},[n("a-icon",{staticStyle:{"font-size":"48px"},attrs:{slot:"indicator",type:"loading",spin:""},slot:"indicator"}),e._v(" "),n("a-card",{class:e.signed_in?"":"has-signin-overlay"},[n("div",{staticClass:"signin-overlay"},[n("h1",[e._v("Set Up")]),e._v(" "),n("p",[e._v("Open settings to set up the document & connect to Matrix")]),e._v(" "),n("a-button",{attrs:{type:"primary",size:"large",shape:"circle",icon:"setting"},on:{click:e.openMatrixSetup}})],1),e._v(" "),n("template",{staticClass:"ant-card-actions",slot:"actions"},[n("a-icon",{attrs:{type:"setting"},on:{click:e.openMatrixSetup}})],1),e._v(" "),n("a-card-meta",{attrs:{title:"Document",description:e.$store.state.matrix.working_room+" - "+e.$store.state.matrix.matrix_state}}),e._v(" "),n("no-ssr",{attrs:{placeholder:"Codemirror Loading..."}},[n("codemirror",{ref:"codemirror",staticStyle:{"text-align":"left",margin:"-24px -32px","margin-top":"3em",overflow:"auto"},attrs:{options:e.cmOption},on:{changes:e.onNewChanges},model:{value:e.text,callback:function(t){e.text=t},expression:"text"}})],1)],2)],1)],1)])}),[],!1,null,null,null));t.default=f.exports}}]);