(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{1341:function(t,e,n){var content=n(1359);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(71).default)("d555ad62",content,!0,{sourceMap:!1})},1342:function(t,e,n){var content=n(1361);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(71).default)("5a2b1ee0",content,!0,{sourceMap:!1})},1344:function(t,e,n){"use strict";n(134),n(135),n(59);var o={props:{cansync:Boolean},data:function(){return{syncdepth:1,breakpoint_options:[{label:"Local insertation events",value:"LI"},{label:"Local removal events",value:"LR"},{label:"Remote insertation events",value:"RI"},{label:"Remote removal events",value:"RR"}]}},methods:{dumpLogoot:function(){this.$matrix.doc&&console.log(this.$matrix.doc.logoot_bst.toString())},dumpLdoc:function(){this.$matrix.doc&&console.log(this.$matrix.doc.ldoc_bst.toString())},dumpRemoval:function(){this.$matrix.doc&&console.log(this.$matrix.doc.removal_bst.toString())}}},r=n(75),component=Object(r.a)(o,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-card",{staticStyle:{"margin-bottom":"20px"}},[n("a-card-meta",{attrs:{title:"Debug Panel",description:t.$store.state.matrix.working_room+" - "+t.$store.state.matrix.matrix_state}}),t._v(" "),n("a-form-item",{attrs:{label:"Breakpoints"}},[n("a-checkbox-group",{attrs:{value:t.$store.getters["debugstate/breakpoints"],options:t.breakpoint_options},on:{input:function(e){return t.$store.commit("debugstate/setBreakpoints",e)}}})],1),t._v(" "),n("a-row",[n("a-col",{attrs:{span:8}},[n("a-form-item",{attrs:{label:"Enable syncback (Only affects initial load)"}},[n("a-switch",{attrs:{checked:t.$store.getters["debugstate/syncback"]},on:{change:function(e){return t.$store.commit("debugstate/setSyncbackEnabled",e)}}})],1)],1),t._v(" "),n("a-col",{attrs:{span:5}},[n("a-form-item",{attrs:{label:"Manual sync"}},[n("a-input-group",{attrs:{compact:""}},[n("a-input-number",{attrs:{min:0,max:1e3,disabled:!t.cansync},model:{value:t.syncdepth,callback:function(e){t.syncdepth=e},expression:"syncdepth"}}),t._v(" "),n("a-button",{attrs:{type:"primary",disabled:!t.cansync},on:{click:function(e){return t.$emit("fetch",t.syncdepth)}}},[t._v("\n            Fetch\n          ")])],1)],1)],1),t._v(" "),n("a-col",{attrs:{span:6}},[n("a-form-item",{attrs:{label:"Dump BST"}},[n("a-button-group",[n("a-button",{on:{click:t.dumpLogoot}},[t._v("Logoot")]),t._v(" "),n("a-button",{on:{click:t.dumpLdoc}},[t._v("Ldoc")]),t._v(" "),n("a-button",{on:{click:t.dumpRemoval}},[t._v("Removal")])],1)],1)],1)],1)],1)}),[],!1,null,null,null);e.a=component.exports},1358:function(t,e,n){"use strict";var o=n(1341);n.n(o).a},1359:function(t,e,n){(t.exports=n(70)(!1)).push([t.i,".vue-codemirror .CodeMirror{height:100%}",""])},1360:function(t,e,n){"use strict";var o=n(1342);n.n(o).a},1361:function(t,e,n){(t.exports=n(70)(!1)).push([t.i,".container{margin:0 auto;min-height:100vh;display:-webkit-box;display:flex;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center;text-align:center}.container>*{width:100%;max-width:1000px}",""])},1364:function(t,e,n){"use strict";n.r(e);n(59),n(90);var o=n(25),r=n(1344),c=(n(136),n(160),n(41)),l={props:{loading:Boolean},data:function(){return{text:"",cmOption:{tabSize:4,foldGutter:!0,styleActiveLine:!0,lineNumbers:!0,line:!0,theme:"mdn-like"},changes_to_ignore:{}}},methods:{insert:function(t,text,meta){var e=this.$refs.codemirror.codemirror.doc;c.a.log("INSERT '".concat(text,"' AT ").concat(t));var n=e.posFromIndex(t);this.changes_to_ignore[n.line]||(this.changes_to_ignore[n.line]=[]),this.changes_to_ignore[n.line].push(n.ch),e.replaceRange(text,n,n)},remove:function(t,e){var n=this.$refs.codemirror.codemirror.doc;c.a.log("REMOVE ".concat(e," CHARS AT ").concat(t));var o=n.posFromIndex(t),r=n.posFromIndex(t+e);this.changes_to_ignore[o.line]||(this.changes_to_ignore[o.line]=[]),this.changes_to_ignore[o.line].push(o.ch),n.replaceRange("",o,r)},onNewChanges:function(t,e){var n=this;e.forEach((function(e){if(n.changes_to_ignore[e.from.line]&&n.changes_to_ignore[e.from.line].includes(e.from.ch))return n.changes_to_ignore[e.from.line].pop(e.from.ch),void(n.changes_to_ignore[e.from.line].length||delete n.changes_to_ignore[e.from.line]);var o,text,r=Object.assign({},e.from),c=t.indexFromPos(r),l=Object.assign({},e.from);o=l,text=e.text,o.line+=text.length-1,text.length>1&&(o.ch=0),o.ch+=text[text.length-1].length;var m=e.removed.length-1;e.removed.forEach((function(t){m+=t.length}));var d=e.text.join("\n");m&&n.$emit("remove",{pos:c,length:m}),d.length&&n.$emit("insert",{pos:c,body:d})}))}}},m=(n(1358),n(75)),d=Object(m.a)(l,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-spin",{attrs:{spinning:t.loading}},[n("a-icon",{staticStyle:{"font-size":"48px"},attrs:{slot:"indicator",type:"loading",spin:""},slot:"indicator"}),t._v(" "),n("a-card",[n("template",{staticClass:"ant-card-actions",slot:"actions"},[n("a-icon",{attrs:{type:"setting"},on:{click:function(e){return t.$emit("settings-clicked")}}})],1),t._v(" "),n("a-card-meta",{attrs:{title:"Document"}}),t._v(" "),n("client-only",{attrs:{placeholder:"Codemirror Loading..."}},[n("codemirror",{ref:"codemirror",staticStyle:{"text-align":"left",margin:"-24px -32px","margin-top":"3em",overflow:"auto"},attrs:{options:t.cmOption},on:{ready:function(e){return t.$emit("ready")},changes:t.onNewChanges},model:{value:t.text,callback:function(e){t.text=e},expression:"text"}})],1)],2)],1)}),[],!1,null,null,null).exports,h={validate:function(t){var e=t.params;return/^[!#][^!#:]*:[^!#:]*(:[0-9]+)?$/gm.test(e.room)},components:{DebugPanel:r.a,DocumentEditor:d},head:function(){return{title:"Edit ".concat(this.$route.params.room)}},data:function(){return{has_fatal_error:!1,cm_ready:!1,cm_resolve_ready:void 0}},watch:{cm_ready:function(){this.cm_ready&&this.cm_resolve_ready&&this.cm_resolve_ready()}},computed:{signed_in:function(){return this.$store.getters["matrix/signedIn"]},is_busy:function(){return this.$store.getters.hasBlockingOperation},is_reconnecting:function(){return"RECONNECTING"===this.$store.state.matrix.matrix_state}},mounted:function(){var t=this;if(this.signed_in){var e=this;e.$store.dispatch("watchBlockingOperation",Object(o.a)(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,new Promise((function(t,n){e.cm_ready?t():e.cm_resolve_ready=t}));case 3:return n.next=5,e.$matrix.createDocument(t.$route.params.room,t.$refs.editor.insert,t.$refs.editor.remove,t.onDocumentError);case 5:o=n.sent,t.documentInsert=function(t){var e=t.pos,body=t.body;return o.insert(e,body)},t.documentRemove=function(t){var e=t.pos,n=t.length;return o.remove(e,n)},t.fetchEvents=function(e){o.fetchEvents(e).then((function(){return t.$message.info("Sync complete")})).catch((function(e){t.$message.error("Sync failed"),console.error(e)}))},n.next=16;break;case 11:n.prev=11,n.t0=n.catch(0),console.error("Failed to open document",n.t0),t.$message.error("Failed to open document!"),t.has_fatal_error=!0;case 16:case"end":return n.stop()}}),n,null,[[0,11]])})))())}},methods:{onDocumentError:function(t){t.fatal?(console.error("Fatal internal error",t),self.$message.error("Fatal internal error")):(console.warn("Internal error",t),self.$message.warning("Internal errors encountered. See console for details"))}}},f=(n(1360),Object(m.a)(h,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container"},[n("div",[t.$store.state.debug?n("DebugPanel",{attrs:{cansync:""},on:{fetch:function(e){return t.fetchEvents?t.fetchEvents(e):void 0}}}):t._e(),t._v(" "),n("div",{staticStyle:{margin:"10px 0px","text-align":"left"}},[n("a-button",{attrs:{type:"primary",icon:"home"},on:{click:function(e){return t.$router.push("/")}}},[t._v("\n        Home\n      ")])],1),t._v(" "),t.has_fatal_error?t._e():n("DocumentEditor",{ref:"editor",attrs:{loading:t.is_busy||t.is_reconnecting},on:{ready:function(e){t.cm_ready=!0},"settings-clicked":t.openMatrixSetup,insert:function(i){return t.documentInsert?t.documentInsert(i):void 0},remove:function(e){return t.documentRemove?t.documentRemove(e):void 0}}}),t._v(" "),t.has_fatal_error?n("div",[n("a-icon",{staticStyle:{"font-size":"64px",color:"#f007"},attrs:{type:"close-circle"}}),t._v(" "),n("h1",[t._v("Fatal error")]),t._v("\n      The document could not be loaded.\n    ")],1):t._e()],1)])}),[],!1,null,null,null));e.default=f.exports}}]);