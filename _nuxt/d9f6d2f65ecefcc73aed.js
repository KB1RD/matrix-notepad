(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{1317:function(e,t,n){var content=n(1334);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(74).default)("d555ad62",content,!0,{sourceMap:!1})},1318:function(e,t,n){var content=n(1336);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(74).default)("5a2b1ee0",content,!0,{sourceMap:!1})},1333:function(e,t,n){"use strict";var o=n(1317);n.n(o).a},1334:function(e,t,n){(t=n(73)(!1)).push([e.i,".vue-codemirror .CodeMirror{height:100%}",""]),e.exports=t},1335:function(e,t,n){"use strict";var o=n(1318);n.n(o).a},1336:function(e,t,n){(t=n(73)(!1)).push([e.i,".container{margin:0 auto;min-height:100vh;display:flex;justify-content:center;align-items:center;text-align:center}.container>*{width:100%;max-width:1000px}",""]),e.exports=t},1339:function(e,t,n){"use strict";n.r(t);n(326),n(327),n(66),n(89);var o=n(25),r=n(27),c=(n(158),n(221),{props:{loading:Boolean},data:function(){return{console:console,text:"",cmOption:{tabSize:4,foldGutter:!0,styleActiveLine:!0,lineNumbers:!0,line:!0,theme:"mdn-like"},changes_to_ignore:{}}},methods:{insert:function(e,text,meta){var t=this.$refs.codemirror.codemirror.doc;r.a.log("INSERT '".concat(text,"' AT ").concat(e));var n=t.posFromIndex(e);this.changes_to_ignore[n.line]||(this.changes_to_ignore[n.line]=[]),this.changes_to_ignore[n.line].push(n.ch),t.replaceRange(text,n,n)},remove:function(e,t){var n=this.$refs.codemirror.codemirror.doc;r.a.log("REMOVE ".concat(t," CHARS AT ").concat(e));var o=n.posFromIndex(e),c=n.posFromIndex(e+t);this.changes_to_ignore[o.line]||(this.changes_to_ignore[o.line]=[]),this.changes_to_ignore[o.line].push(o.ch),n.replaceRange("",o,c)},translate:function(e,t,n){var o=this.$refs.codemirror.codemirror.doc;r.a.log("TRANSLATE ".concat(n," CHARS FROM ").concat(e," -> ").concat(t));var c=o.posFromIndex(e),d=o.posFromIndex(e+n),body=o.getRange(c,d);this.remove(e,n),this.insert(t,body)},onNewChanges:function(e,t){if(this.changes_to_ignore[t.from.line]&&this.changes_to_ignore[t.from.line].includes(t.from.ch))return this.changes_to_ignore[t.from.line].pop(t.from.ch),void(this.changes_to_ignore[t.from.line].length||delete this.changes_to_ignore[t.from.line]);t.cancel();var n=Object.assign({},t.from),o=e.indexFromPos(n),r=Object.assign({},t.to),c=e.indexFromPos(r)-o,d=t.text.join("\n");c&&this.$emit("remove",{pos:o,length:c}),d.length&&this.$emit("insert",{pos:o,body:d})}}}),d=(n(1333),n(76)),l={validate:function(e){var t=e.params;return/^[!#][^!#:]*:[^!#:]*(:[0-9]+)?$/gm.test(t.room)},components:{DocumentEditor:Object(d.a)(c,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-spin",{attrs:{spinning:e.loading}},[n("a-icon",{staticStyle:{"font-size":"48px"},attrs:{slot:"indicator",type:"loading",spin:""},slot:"indicator"}),e._v(" "),n("a-card",[n("a-card-meta",{attrs:{title:"Document"}}),e._v(" "),n("client-only",{attrs:{placeholder:"Codemirror Loading..."}},[n("codemirror",{ref:"codemirror",staticStyle:{"text-align":"left",margin:"-24px -32px","margin-top":"3em",overflow:"auto"},attrs:{options:e.cmOption},on:{ready:function(t){return e.$emit("ready")},beforeChange:e.onNewChanges},model:{value:e.text,callback:function(t){e.text=t},expression:"text"}})],1)],1)],1)}),[],!1,null,null,null).exports},head:function(){return{title:"Edit ".concat(this.$route.params.room)}},data:function(){return{has_fatal_error:!1,cm_ready:!1,cm_resolve_ready:void 0,document_symbol:void 0}},computed:{signed_in:function(){return this.$store.getters["matrix/signedIn"]},is_busy:function(){return this.$store.getters.hasBlockingOperation},is_reconnecting:function(){return"RECONNECTING"===this.$store.state.matrix.matrix_state}},watch:{cm_ready:function(){this.cm_ready&&this.cm_resolve_ready&&this.cm_resolve_ready()}},mounted:function(){var e=this;if(this.signed_in){var t=this;t.$store.dispatch("watchBlockingOperation",Object(o.a)(regeneratorRuntime.mark((function n(){var o,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,new Promise((function(e,n){t.cm_ready?e():t.cm_resolve_ready=e}));case 3:return o=function(t){t.forEach((function(t){switch(t.type){case"i":return void e.$refs.editor.insert(t.start,t.body);case"r":return void e.$refs.editor.remove(t.start,t.length);case"t":e.$refs.editor.translate(t.source,t.dest,t.length)}}))},n.next=6,t.$matrix.createDocument(e.$route.params.room,o,e.onDocumentError);case 6:c=n.sent,e.$debug.active_document=c,Object.defineProperty(e,"document",{get:function(){return c}}),e.documentInsert=function(e){var t=e.pos,body=e.body;return c.insert(t,body)},e.documentRemove=function(e){var t=e.pos,n=e.length;return c.remove(t,n)},e.fetchEvents=function(t){c.fetchEvents(t).then((function(){return e.$message.info("Sync complete")})).catch((function(t){e.$message.error("Sync failed"),r.a.error(t)}))},n.next=19;break;case 14:n.prev=14,n.t0=n.catch(0),r.a.error("Failed to open document",n.t0),e.$message.error("Failed to open document!"),e.has_fatal_error=!0;case 19:case"end":return n.stop()}}),n,null,[[0,14]])})))())}},beforeDestroy:function(){this.document&&this.$matrix.shutdownDocument(this.document)},methods:{onDocumentError:function(e,t){e.fatal?(r.a.error("Fatal internal error",e),this.$message.error("Fatal internal error"),this.has_fatal_error=!0,this.$matrix.shutdownDocument(t)):(r.a.warn("Internal error",e),this.$message.warning("Internal errors encountered. See console for details"))},dumpLogoot:function(){this.document&&r.a.info(this.document.doc.logoot_bst.toString())},dumpLdoc:function(){this.document&&r.a.info(this.document.doc.ldoc_bst.toString())},dumpRemoval:function(){this.document&&r.a.info(this.document.doc.removal_bst.toString())}}},m=(n(1335),Object(d.a)(l,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container"},[n("div",[n("div",{staticStyle:{margin:"10px 0px","text-align":"left"}},[n("a-button",{attrs:{type:"primary",icon:"home"},on:{click:function(t){return e.$router.push("/")}}},[e._v("\n        Home\n      ")])],1),e._v(" "),e.has_fatal_error?e._e():n("DocumentEditor",{ref:"editor",attrs:{loading:e.is_busy||e.is_reconnecting},on:{ready:function(t){e.cm_ready=!0},insert:function(i){return e.documentInsert?e.documentInsert(i):void 0},remove:function(t){return e.documentRemove?e.documentRemove(t):void 0}}}),e._v(" "),e.has_fatal_error?n("div",[n("a-icon",{staticStyle:{"font-size":"64px",color:"#f007"},attrs:{type:"close-circle"}}),e._v(" "),n("h1",[e._v("Fatal error")]),e._v("\n      The document could not be loaded.\n    ")],1):e._e()],1)])}),[],!1,null,null,null));t.default=m.exports}}]);