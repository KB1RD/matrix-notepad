(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{1301:function(t,e,n){var content=n(1303);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(73).default)("6759f5ab",content,!0,{sourceMap:!1})},1302:function(t,e,n){"use strict";var o=n(1301);n.n(o).a},1303:function(t,e,n){(t.exports=n(72)(!1)).push([t.i,".vue-codemirror .CodeMirror{height:100%}.container{margin:0 auto;min-height:100vh;display:-webkit-box;display:flex;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center;text-align:center}.container>*{width:100%;max-width:1000px}.signin-overlay{display:none}.has-signin-overlay .signin-overlay{display:block;width:100%;height:100%;position:absolute;top:0;left:0;display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center;background-color:hsla(0,0%,100%,.86667);z-index:1000}",""])},1304:function(t,e,n){"use strict";n.r(e);n(329),n(104),n(133),n(159),n(88),n(58),n(219);var o=n(213),r=n(324),c={props:{working:Boolean,signedIn:Boolean},data:function(){return{settings:this.$form.createForm(this)}},methods:{submit:function(t){t.preventDefault();var e=this;this.settings.validateFields((function(t,n){t||e.$emit("submit",n)}))}}},l=n(111),m=Object(l.a)(c,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-form",{attrs:{form:t.settings,layout:"vertical","hide-required-mark":""},on:{submit:t.submit}},[n("a-row",{attrs:{gutter:16}},[n("a-col",[t._v("\n      Note that this software is "),n("b",[t._v("highly")]),t._v(" experimental. Do "),n("b",[t._v("not")]),t._v(" use\n      this to store confidential or important information. Also, this adds a\n      ton of events to whichever room is chosen, so... be careful. Also, most\n      upgrades will introduce breaking changes at the moment with no real\n      upgrade path. Sorry.\n    ")])],1),t._v(" "),n("a-row",{attrs:{gutter:16}},[n("a-col",[n("a-form-item",{attrs:{label:"Homeserver Name"}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["hs",{initialValue:t.$store.state.matrix.credentials.hs}],expression:"[\n            'hs',\n            { initialValue: $store.state.matrix.credentials.hs }\n          ]"}],attrs:{placeholder:"https://matrix.org"}})],1)],1)],1),t._v(" "),n("a-row",{attrs:{gutter:16}},[n("a-col",[n("a-form-item",{attrs:{label:"Access Token"}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["token",{initialValue:t.$store.state.matrix.credentials.access_token,rules:[{required:!0,message:"An access token is required"}]}],expression:"[\n            'token',\n            {\n              initialValue: $store.state.matrix.credentials.access_token,\n              rules: [\n                {\n                  required: true,\n                  message: 'An access token is required'\n                }\n              ]\n            }\n          ]"}],attrs:{placeholder:"ABCDEF1234"}})],1)],1)],1),t._v(" "),n("a-row",{attrs:{gutter:16}},[n("a-col",[n("a-form-item",{attrs:{label:"Room"}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["room",{initialValue:t.$store.state.matrix.working_room,rules:[{required:!0,message:"A room to join is required"},{pattern:/^[!#][^\!\:]*:[^\!\:]*(:[0-9]+)?$/gm,message:"This is not a valid Matrix room ID or alias"}]}],expression:"[\n            'room',\n            {\n              initialValue: $store.state.matrix.working_room,\n              rules: [\n                {\n                  required: true,\n                  message: 'A room to join is required'\n                },\n                {\n                  pattern: /^[!#][^\\!\\:]*:[^\\!\\:]*(:[0-9]+)?$/gm,\n                  message: 'This is not a valid Matrix room ID or alias'\n                }\n              ]\n            }\n          ]"}],attrs:{placeholder:"!roomid:matrix.org"}})],1)],1)],1),t._v(" "),n("a-row",{attrs:{gutter:16}},[n("a-col",[n("a-form-item",[n("a-checkbox",{directives:[{name:"decorator",rawName:"v-decorator",value:["debug",{initialValue:t.$store.state.debug}],expression:"['debug', { initialValue: $store.state.debug }]"}]},[t._v("\n          Enable debug mode\n        ")])],1)],1)],1),t._v(" "),n("a-row",{attrs:{gutter:16}},[n("a-col",[n("a-button",{attrs:{type:"primary",loading:t.working,"html-type":"submit"}},[t._v("\n        "+t._s(t.working?"Working...":t.signedIn?"Update":"Sign In")+"\n      ")])],1)],1)],1)}),[],!1,null,null,null).exports,d=(n(134),n(135),{data:function(){return{syncdepth:1,breakpoint_options:[{label:"Local insertation events",value:"LI"},{label:"Local removal events",value:"LR"},{label:"Remote insertation events",value:"RI"},{label:"Remote removal events",value:"RR"}]}},methods:{fetchSyncback:function(){var t=this;this.$matrix.manualSync&&this.$matrix.manualSync(this.syncdepth).then((function(){return t.$message.info("Sync complete")})).catch((function(e){t.$message.error("Sync failed"),console.error(e)}))},dumpLogoot:function(){this.$matrix.doc&&console.log(this.$matrix.doc.logoot_bst.toString())},dumpLdoc:function(){this.$matrix.doc&&console.log(this.$matrix.doc.ldoc_bst.toString())},dumpRemoval:function(){this.$matrix.doc&&console.log(this.$matrix.doc.removal_bst.toString())}}}),h=Object(l.a)(d,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-card",{staticStyle:{"margin-bottom":"20px"}},[n("a-card-meta",{attrs:{title:"Debug Panel",description:t.$store.state.matrix.working_room+" - "+t.$store.state.matrix.matrix_state}}),t._v(" "),n("a-form-item",{attrs:{label:"Breakpoints"}},[n("a-checkbox-group",{attrs:{value:t.$store.getters["debugstate/breakpoints"],options:t.breakpoint_options},on:{input:function(e){return t.$store.commit("debugstate/setBreakpoints",e)}}})],1),t._v(" "),n("a-row",[n("a-col",{attrs:{span:8}},[n("a-form-item",{attrs:{label:"Enable syncback (Only affects initial load)"}},[n("a-switch",{attrs:{checked:t.$store.getters["debugstate/syncback"]},on:{change:function(e){return t.$store.commit("debugstate/setSyncbackEnabled",e)}}})],1)],1),t._v(" "),n("a-col",{attrs:{span:5}},[n("a-form-item",{attrs:{label:"Manual sync"}},[n("a-input-group",{attrs:{compact:""}},[n("a-input-number",{attrs:{min:0,max:1e3},model:{value:t.syncdepth,callback:function(e){t.syncdepth=e},expression:"syncdepth"}}),t._v(" "),n("a-button",{attrs:{type:"primary"},on:{click:t.fetchSyncback}},[t._v("Fetch")])],1)],1)],1),t._v(" "),n("a-col",{attrs:{span:5}},[n("a-form-item",{attrs:{label:"Assign window variables"}},[n("a-switch",{attrs:{checked:t.$store.getters["debugstate/shouldAssignWindowVars"]},on:{change:function(e){return t.$store.commit("debugstate/setAssignWindowVars",e)}}})],1)],1),t._v(" "),n("a-col",{attrs:{span:6}},[n("a-form-item",{attrs:{label:"Dump BST"}},[n("a-button-group",[n("a-button",{on:{click:t.dumpLogoot}},[t._v("Logoot")]),t._v(" "),n("a-button",{on:{click:t.dumpLdoc}},[t._v("Ldoc")]),t._v(" "),n("a-button",{on:{click:t.dumpRemoval}},[t._v("Removal")])],1)],1)],1)],1)],1)}),[],!1,null,null,null).exports,v=n(50);function f(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}var _={components:{TemporarySignin:m,DebugPanel:h},data:function(){return{setup_visible:!1,text:"",cmOption:{tabSize:4,foldGutter:!0,styleActiveLine:!0,lineNumbers:!0,line:!0,theme:"mdn-like"},changes_to_ignore:{}}},computed:{signed_in:function(){return this.$store.state.matrix.matrix_state&&"STOPPED"!==this.$store.state.matrix.matrix_state},is_busy:function(){return this.$store.getters.hasBlockingOperation},is_reconnecting:function(){return"RECONNECTING"===this.$store.state.matrix.matrix_state}},created:function(){if(this.$store.state.matrix.credentials.hs&&this.$store.state.matrix.credentials.access_token&&this.$store.state.matrix.working_room){var t=this.$store.state.matrix;this.signIn(t.credentials.hs,t.credentials.access_token,t.working_room)}},methods:function(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?f(source,!0).forEach((function(e){Object(o.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):f(source).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}({openMatrixSetup:function(){this.setup_visible=!0},closeMatrixSetup:function(){this.setup_visible=!1,this.signed_in||this.$message.warning("Operation cancelled. You are not signed in")},signIn:function(t,e,n){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.$matrix.shutdown(),this.text="",this.changes_to_ignore={};var r=this.$message.loading("Signing in...",0),c=this;c.$store.dispatch("watchBlockingOperation",c.$matrix.attemptSignIn(t,e,n,(function(t){t.fatal?(console.error("Fatal internal error",t),c.$message.error("Fatal internal error")):(console.warn("Internal error",t),c.$message.warning("Internal errors encountered. See console for details"))}),this.onRemoteInsert,this.onRemoteRemove).then((function(){o&&c.updateSettings({hs:t,token:e,room:n}),r(),c.$message.success("You're signed in!"),c.setup_visible=!1}),(function(t){r(),console.error("Failed to sign in",t),c.$message.error("Failed to sign in!")})))},onSettingsFormSubmit:function(t){var e={hs:"https://matrix.org"};Object.keys(t).forEach((function(n){!t[n]&&0!==t[n]||""===t[n]||(e[n]=t[n])})),this.setDebugEnabled(t.debug),this.signIn(e.hs,e.token,e.room,!0)},onRemoteInsert:function(t,text,meta){var e=this.$refs.codemirror.codemirror.doc;v.a.log("INSERT '".concat(text,"' AT ").concat(t));var n=e.posFromIndex(t);this.changes_to_ignore[n.line]||(this.changes_to_ignore[n.line]=[]),this.changes_to_ignore[n.line].push(n.ch),e.replaceRange(text,n,n)},onRemoteRemove:function(t,e){var n=this.$refs.codemirror.codemirror.doc;v.a.log("REMOVE ".concat(e," CHARS AT ").concat(t));var o=n.posFromIndex(t),r=n.posFromIndex(t+e);this.changes_to_ignore[o.line]||(this.changes_to_ignore[o.line]=[]),this.changes_to_ignore[o.line].push(o.ch),n.replaceRange("",o,r)},onNewChanges:function(t,e){var n=this;if(this.$matrix.doc){var o=this.$matrix;e.forEach((function(e){if(n.changes_to_ignore[e.from.line]&&n.changes_to_ignore[e.from.line].includes(e.from.ch))return n.changes_to_ignore[e.from.line].pop(e.from.ch),void(n.changes_to_ignore[e.from.line].length||delete n.changes_to_ignore[e.from.line]);var r,text,c=Object.assign({},e.from),l=t.indexFromPos(c),m=Object.assign({},e.from);r=m,text=e.text,r.line+=text.length-1,text.length>1&&(r.ch=0),r.ch+=text[text.length-1].length;var d=e.removed.length-1;e.removed.forEach((function(t){d+=t.length}));var h=e.text.join("\n");d&&o.doc.remove(l,d),h.length&&o.doc.insert(l,h)}))}}},Object(r.b)({updateSettings:"matrix/updateSettings",setDebugEnabled:"setDebugEnabled"}))},x=(n(1302),Object(l.a)(_,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container"},[n("div",[n("a-drawer",{attrs:{visible:t.setup_visible,title:"Matrix Setup",placement:"right",closable:!0},on:{close:t.closeMatrixSetup}},[n("TemporarySignin",{attrs:{working:t.is_busy,"signed-in":t.signed_in},on:{submit:t.onSettingsFormSubmit}})],1),t._v(" "),t.$store.state.debug?n("DebugPanel"):t._e(),t._v(" "),n("a-spin",{attrs:{spinning:t.is_busy||t.is_reconnecting}},[n("a-icon",{staticStyle:{"font-size":"48px"},attrs:{slot:"indicator",type:"loading",spin:""},slot:"indicator"}),t._v(" "),n("a-card",{class:t.signed_in?"":"has-signin-overlay"},[n("div",{staticClass:"signin-overlay"},[n("h1",[t._v("Set Up")]),t._v(" "),n("p",[t._v("Open settings to set up the document & connect to Matrix")]),t._v(" "),n("a-button",{attrs:{type:"primary",size:"large",shape:"circle",icon:"setting"},on:{click:t.openMatrixSetup}})],1),t._v(" "),n("template",{staticClass:"ant-card-actions",slot:"actions"},[n("a-icon",{attrs:{type:"setting"},on:{click:t.openMatrixSetup}})],1),t._v(" "),n("a-card-meta",{attrs:{title:"Document"}}),t._v(" "),n("no-ssr",{attrs:{placeholder:"Codemirror Loading..."}},[n("codemirror",{ref:"codemirror",staticStyle:{"text-align":"left",margin:"-24px -32px","margin-top":"3em",overflow:"auto"},attrs:{options:t.cmOption},on:{changes:t.onNewChanges},model:{value:t.text,callback:function(e){t.text=e},expression:"text"}})],1)],2)],1)],1)])}),[],!1,null,null,null));e.default=x.exports}}]);