(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{571:function(t,e,n){var content=n(589);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(73).default)("d555ad62",content,!0,{sourceMap:!1})},572:function(t,e,n){var content=n(591);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(73).default)("5a2b1ee0",content,!0,{sourceMap:!1})},588:function(t,e,n){"use strict";var r=n(571);n.n(r).a},589:function(t,e,n){(e=n(72)(!1)).push([t.i,".vue-codemirror .CodeMirror{height:100%}.input-text-unless-focus:not(:focus){background-color:rgba(0,0,0,.0549);border-color:transparent}.with-loading{position:relative}.with-loading>:first-child{position:absolute;z-index:-100;top:0;left:0;bottom:0;right:0;width:100%;height:100%}.with-loading[data-loading]>:first-child{z-index:100}.with-loading[data-loading]>:not(:first-child){opacity:.5}",""]),t.exports=e},590:function(t,e,n){"use strict";var r=n(572);n.n(r).a},591:function(t,e,n){(e=n(72)(!1)).push([t.i,".container{margin:0 auto;min-height:100vh;display:flex;justify-content:center;align-items:center;text-align:center}.container>*{width:100%;max-width:1000px}",""]),t.exports=e},594:function(t,e,n){"use strict";n.r(e);n(10),n(82);var r=n(27),o=n(34),c=(n(105),n(120),{props:{loading:Boolean,title:{default:"",type:String}},data:function(){return{internal_title:"",cmOption:{tabSize:4,foldGutter:!0,styleActiveLine:!0,lineNumbers:!0,line:!0,theme:"mdn-like"},console:console,changes_to_ignore:{}}},watch:{title:function(){this.internal_title=this.title}},mounted:function(){this.internal_title=this.title},methods:{onTitleChangeRequested:function(){this.$emit("set-title",this.internal_title)},onTitleInputKeyEvent:function(t){switch(t.keyCode){case 13:this.onTitleChangeRequested(),t.target.blur();break;case 27:t.target.blur()}},insert:function(t,text,meta){var e=this.$refs.codemirror.codemirror.doc;o.a.log("INSERT '".concat(text,"' AT ").concat(t));var n=e.posFromIndex(t);this.changes_to_ignore[n.line]||(this.changes_to_ignore[n.line]=[]),this.changes_to_ignore[n.line].push(n.ch),e.replaceRange(text,n,n)},remove:function(t,e){var n=this.$refs.codemirror.codemirror.doc;o.a.log("REMOVE ".concat(e," CHARS AT ").concat(t));var r=n.posFromIndex(t),c=n.posFromIndex(t+e);this.changes_to_ignore[r.line]||(this.changes_to_ignore[r.line]=[]),this.changes_to_ignore[r.line].push(r.ch),n.replaceRange("",r,c)},translate:function(t,e,n){var r=this.$refs.codemirror.codemirror.doc;o.a.log("TRANSLATE ".concat(n," CHARS FROM ").concat(t," -> ").concat(e));var c=r.posFromIndex(t),l=r.posFromIndex(t+n),body=r.getRange(c,l);this.remove(t,n),this.insert(e,body)},onNewChanges:function(t,e){if(this.changes_to_ignore[e.from.line]&&this.changes_to_ignore[e.from.line].includes(e.from.ch))return this.changes_to_ignore[e.from.line].pop(e.from.ch),void(this.changes_to_ignore[e.from.line].length||delete this.changes_to_ignore[e.from.line]);e.cancel();var n=Object.assign({},e.from),r=t.indexFromPos(n),o=Object.assign({},e.to),c=t.indexFromPos(o)-r,l=e.text.join("\n");c&&this.$emit("remove",{pos:r,length:c}),l.length&&this.$emit("insert",{pos:r,body:l})}}}),l=(n(588),n(81)),d={validate:function(t){var e=t.params;return/^[!#][^!#:]*:[^!#:]*(:[0-9]+)?$/gm.test(e.room)},components:{DocumentEditor:Object(l.a)(c,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"with-loading",attrs:{"data-loading":t.loading}},[n("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"center"}},[n("b-spinner",{staticStyle:{width:"3rem",height:"3rem"},attrs:{label:"Loading..."}})],1),t._v(" "),n("b-card",{attrs:{"bg-variant":"light"},scopedSlots:t._u([{key:"header",fn:function(){return[n("b-input-group",[n("b-form-input",{staticClass:"input-text-unless-focus",attrs:{size:"lg",placeholder:"Untitled Document"},on:{blur:function(t){return t.target.focus()},keyup:t.onTitleInputKeyEvent},model:{value:t.internal_title,callback:function(e){t.internal_title=e},expression:"internal_title"}}),t._v(" "),t.internal_title!==t.title?n("b-input-group-append",[n("b-button",{attrs:{variant:"success"},on:{click:function(e){return t.onTitleChangeRequested()}}},[n("b-icon",{attrs:{icon:"check"}})],1),t._v(" "),n("b-button",{attrs:{variant:"danger"},on:{click:function(){return t.internal_title=t.title}}},[n("b-icon",{attrs:{icon:"x"}})],1)],1):t._e()],1)]},proxy:!0}])},[t._v(" "),n("client-only",{attrs:{placeholder:"Codemirror Loading..."}},[n("codemirror",{ref:"codemirror",staticStyle:{"text-align":"left",margin:"0px -20px","margin-top":"3em",overflow:"auto"},attrs:{options:t.cmOption},on:{ready:function(e){return t.$emit("ready")},beforeChange:t.onNewChanges}})],1)],1)],1)}),[],!1,null,null,null).exports},head:function(){return{title:"Edit ".concat(this.$route.params.room)}},data:function(){return{has_fatal_error:!1,cm_ready:!1,cm_resolve_ready:void 0,document_symbol:void 0}},computed:{signed_in:function(){return this.$store.getters["matrix/signedIn"]},is_busy:function(){return this.$store.getters.hasBlockingOperation},is_reconnecting:function(){return"RECONNECTING"===this.$store.state.matrix.matrix_state},room:function(){return this.$store.getters["matrix/room"](this.$route.params.room)}},watch:{cm_ready:function(){this.cm_ready&&this.cm_resolve_ready&&this.cm_resolve_ready()}},mounted:function(){var t=this;if(this.signed_in){var e=this;e.$store.dispatch("watchBlockingOperation",Object(r.a)(regeneratorRuntime.mark((function n(){var r,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,new Promise((function(t,n){e.cm_ready?t():e.cm_resolve_ready=t}));case 3:return r=function(e){e.forEach((function(e){switch(e.type){case"i":return void t.$refs.editor.insert(e.start,e.body);case"r":return void t.$refs.editor.remove(e.start,e.length);case"t":t.$refs.editor.translate(e.source,e.dest,e.length)}}))},n.next=6,e.$matrix.createDocument(t.$route.params.room,r,t.onDocumentError);case 6:c=n.sent,t.$debug.active_document=c,Object.defineProperty(t,"document",{get:function(){return c}}),t.documentInsert=function(t){var e=t.pos,body=t.body;return c.insert(e,body)},t.documentRemove=function(t){var e=t.pos,n=t.length;return c.remove(e,n)},t.fetchEvents=function(t){c.fetchEvents(t).catch((function(t){o.a.error(t)}))},n.next=18;break;case 14:n.prev=14,n.t0=n.catch(0),o.a.error("Failed to open document",n.t0),t.has_fatal_error=!0;case 18:case"end":return n.stop()}}),n,null,[[0,14]])})))())}},beforeDestroy:function(){this.document&&this.$matrix.shutdownDocument(this.document)},methods:{onDocumentError:function(t,e){t.fatal?(o.a.error("Fatal internal error",t),this.has_fatal_error=!0,this.$matrix.shutdownDocument(e)):o.a.warn("Internal error",t)},setTitle:function(t){this.$matrix.client.sendStateEvent(this.$route.params.room,"m.room.name",{name:t}).then((function(){o.a.info("Set room title to '".concat(t,"'"))}),(function(t){o.a.warn("Failed to set title",t)}))}}},h=(n(590),Object(l.a)(d,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container"},[n("div",[n("div",{staticStyle:{margin:"10px 0px","text-align":"left"}},[n("b-button",{attrs:{size:"sm"},on:{click:function(e){return t.$router.push("/")}}},[n("b-icon",{attrs:{icon:"house","aria-hidden":"true"}}),t._v("\n        Home\n      ")],1)],1),t._v(" "),t.has_fatal_error?t._e():n("DocumentEditor",{ref:"editor",attrs:{title:t.room.name,loading:t.is_busy||t.is_reconnecting},on:{ready:function(e){t.cm_ready=!0},insert:function(i){return t.documentInsert?t.documentInsert(i):void 0},remove:function(e){return t.documentRemove?t.documentRemove(e):void 0},"set-title":function(e){return t.setTitle(e)}}}),t._v(" "),t.has_fatal_error?n("div",[n("b-icon",{staticStyle:{width:"64px",height:"64px",color:"#f007"},attrs:{icon:"alert-circle-fill"}}),t._v(" "),n("h1",[t._v("Fatal error")]),t._v("\n      The document could not be loaded.\n    ")],1):t._e()],1)])}),[],!1,null,null,null));e.default=h.exports}}]);